#
# Copyright . All Rights Reserved.
#

version: '3.7'

volumes:
  orderer:

services:
  orderer:
    container_name: orderer.${ORG:-org1}.${DOMAIN:-example.com}
    restart: always
    image: ${DOCKER_REGISTRY:-docker.io}/bftsmart/fabric-orderingnode:amd64-${FABRIC_VERSION:-1.3.0}
    environment:
      - FABRIC_LOGGING_SPEC=orderer=DEBUG:endorser=DEBUG:nodeCmd=DEBUG:committer=DEBUG
#      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0
#      - ORDERER_GENERAL_GENESISMETHOD=file
#      - ORDERER_GENERAL_GENESISFILE=/etc/hyperledger/bft-config/genesisblock
#      - ORDERER_GENERAL_LOCALMSPID=orderer
#      - ORDERER_GENERAL_LOCALMSPDIR=/etc/hyperledger/crypto/orderer/msp
#      - ORDERER_GENERAL_TLS_ENABLED=true
#      - ORDERER_GENERAL_TLS_PRIVATEKEY=/etc/hyperledger/crypto/orderer/tls/server.key
#      - ORDERER_GENERAL_TLS_CERTIFICATE=/etc/hyperledger/crypto/orderer/tls/server.crt
#      - ORDERER_GENERAL_TLS_ROOTCAS=[/etc/hyperledger/crypto/orderer/tls/ca.crt]

      - NODE_CONFIG_DIR=/bft-config
    command: ${ORDERER_NODE_ID:-0}
#    depends_on:
#      - pre-install
    volumes:
      - ./crypto-config/bft/${ORG:-org1}-orderer/config:/bft-config
      - ./crypto-config/configtx:/etc/hyperledger/configtx
      - ./crypto-config/ordererOrganizations/${DOMAIN:-example.com}/orderers/orderer.${DOMAIN:-example.com}/:/etc/hyperledger/crypto/orderer
      - orderer:/var/hyperledger/production/orderer


networks:
  default:
    external:
      name: fabric-starter_default

